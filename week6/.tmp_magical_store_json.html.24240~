<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<title>Magical Store with catalog served from a JSON service</title>
        
        <LINK href="style.css" rel="stylesheet" type="text/css">
        
        <script src="MagicalItem.js" type="text/javascript"></script>
        <script src="MagicalItemView.js" type="text/javascript"></script>
        <script src="ShoppingCart.js" type="text/javascript"></script>
        
        <script>
            //set by the javascript in catalog_json.js
            var characters = null;
            var characterItems = null;
            var magicalItems = null;
        </script>
        
        <script src="http://127.0.0.1/~lorien234/javascript_class_week6/catalog_json.js"></script>
        
        <script>
            
            var itemNameHash = {};
            
            //turn our data objects into MagicalItems
            for (var i=0, l=magicalItems.length; i<l; i++) {
                
                var item = magicalItems[i];
                magicalItems[i].__proto__ = new MagicalItem;
                magicalItems[i].constructor = MagicalItem;
                
                itemNameHash[item.name] = item;
                
                console.log(magicalItems[i].__proto__, magicalItems[i].regenerate);
            }
            
            function buildCharacterSelect() {
                var charSelect = document.getElementById('characterSelect');
                console.log('buildCharacterSelect', charSelect);
                
                for (var i=0, l=characters.length; i<l; i++) {
                    
                    charSelect.options[i+1] = new Option(characters[i], characters[i]);
                }
                
                charSelect.onchange = function() {
                    var chosenOption = this.options[this.selectedIndex];
                    if (chosenOption.value == 0) return;
                    
                    buildCatalog(chosenOption.value);
                }
            }
            
            function buildCatalog(character) {
                
                
                var itemNamesArray = characterItems[character];
                console.log(itemNamesArray);
                
                var cartDiv = document.getElementById('cart');
                window.shoppingCart = new ShoppingCart(cartDiv);
                
                var catalogDiv = document.getElementById('catalog');
                catalogDiv.innerHTML = "";
                
                for (var i=0, l=itemNamesArray.length; i<l; i++) {
                    var item = itemNameHash[itemNamesArray[i]];
                    var itemView = new MagicalItemView(catalogDiv, item);
                    itemView.draw();
                }
            }
            
        </script>
	</head>
    <body onload="buildCharacterSelect();">
        <h1>Magical Store with JSON</h1>
        <hr />
        
        <div>
            <h2>Catalog</h2>
            <select id="characterSelect">
                <option value="0">--- Select a character ---</option>
            </select>
            <br/>
            <br/>
        </div>
        <div id="catalog"></div>
        <div id="cart"></div>
    </body>
</html>
