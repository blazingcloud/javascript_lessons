<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
		<title>Magical Store with catalog served from a JSON service</title>
        
        <LINK href="style.css" rel="stylesheet" type="text/css">
        
        <script>
            //set by the javascript in catalog_json.js
            var magical_store = {};
            magical_store.characters = null;
            magical_store.characterItems = null;
            magical_store.magicalItems = null;
        </script>
        
        <script src="MagicalItem.js" type="text/javascript"></script>
        <script src="MagicalItemView.js" type="text/javascript"></script>
        <script src="ShoppingCart.js" type="text/javascript"></script>
        
        <script src="http://127.0.0.1/~lorien234/javascript_class_week6/catalog_json.js"></script>
        
        <script>
            
            var itemNameHash = {};
            
            //turn our data objects into MagicalItems
            for (var i=0, l=magical_store.magicalItems.length; i<l; i++) {
                
                var item = magical_store.magicalItems[i];
                magical_store.magicalItems[i].__proto__ = new magical_store.MagicalItem;
                magical_store.magicalItems[i].constructor = magical_store.MagicalItem;
                
                itemNameHash[item.name] = item;
                
                console.log(magical_store.magicalItems[i].__proto__, magical_store.magicalItems[i].regenerate);
            }
            
            function buildCharacterSelect() {
                var charSelect = document.getElementById('characterSelect');
                console.log('buildCharacterSelect', charSelect);
                
                for (var i=0, l=magical_store.characters.length; i<l; i++) {
                    
                    charSelect.options[i+1] = new Option(magical_store.characters[i], magical_store.characters[i]);
                }
                
                charSelect.onchange = function() {
                    var chosenOption = this.options[this.selectedIndex];
                    if (chosenOption.value == 0) return;
                    
                    buildCatalog(chosenOption.value);
                }
            }
            
            function buildCatalog(character) {
                
                var itemNamesArray = magical_store.characterItems[character];
                console.log(itemNamesArray);
                
                var cartDiv = document.getElementById('cart');
                window.shoppingCart = new magical_store.ShoppingCart(cartDiv);
                
                var catalogDiv = document.getElementById('catalog');
                catalogDiv.innerHTML = "";
                
                for (var i=0, l=itemNamesArray.length; i<l; i++) {
                    var item = itemNameHash[itemNamesArray[i]];
                    var itemView = new magical_store.MagicalItemView(catalogDiv, item);
                    itemView.draw();
                }
            }
            
        </script>
	</head>
    <body onload="buildCharacterSelect();">
        <h1>Magical Store with JSON</h1>
        <hr />
        
        <div>
            <h2>Catalog</h2>
            <select id="characterSelect">
                <option value="0">--- Select a character ---</option>
            </select>
            <br/>
            <br/>
        </div>
        <div id="catalog"></div>
        <div id="cart">
            <div id="cart_total">Total Price: $<span id="cart_dollars"></span></div>
        </div>
    </body>
</html>
